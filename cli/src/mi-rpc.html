<script>
class MiRpc extends Polymer.Element {

  static get properties(){
    return {
      server: {
        type: String,
        value: "http://api.leonard.zone"
      },
      ironAjax: Object
    }
  }

  ready() {
    super.ready();
  }

  /**
  * @function sendData
  * @param url : url to the api functionnality
  * @param data : structured data
  * @param method : http method
  *
  * @return void
  */
  sendData(url, data, method){
    if(!this.ironAjax){
      this.ironAjax = document.createElement('iron-ajax');
      this.ironAjax.id = "requestBucket";
      document.body.append(this.ironAjax);
      // Callaback ;)
      this.ironAjax.addEventListener('response', this._handleResponse);
      this.ironAjax.addEventListener('error', this._handleError);
    }
    this.ironAjax.url = this.server + url;
    this.ironAjax.body = JSON.stringify(data);
    this.ironAjax.handleAs = "json";
    this.ironAjax.method = method;
    this.ironAjax.generateRequest();
  }

  _handleResponse(data){
    console.log("handleResponse: ", data);
  }
  _handleError(data){
    console.log("handleError: ", data);
  }
}

customElements.define('mi-rpc', MiRpc);
</script>
